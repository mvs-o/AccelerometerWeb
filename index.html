<!DOCTYPE html>
<html>
<head>
	<title>Accelerometer API</title>
	<meta charset="UTF-8">
</head>
<body>
	<div class="coordinates animate done">
		<h4>Ускорение:</h4>
		<div>
			x: <span id="acceleration-x">0</span><span> м/с²</span>
		</div>
		<div>
			y: <span id="acceleration-y">0</span><span> м/с²</span>
		</div>
		<div>
			z: <span id="acceleration-z">0</span><span> м/с²</span>
		</div>
		<div>
			xyz: <span id="acceleration-xyz">0</span><span> м/с²</span>
		</div>
		<div>
			max: <span id="max-acceleration">0</span><span> м/с²</span>
		</div>

		<h4>Ускорение с гравитацией:</h4>
		<div>
			x: <span id="acceleration-gravity-x">0</span><span> м/с²</span>
		</div>
		<div>
			y: <span id="acceleration-gravity-y">0</span><span> м/с²</span>
		</div>
		<div>
			z: <span id="acceleration-gravity-z">0</span><span> м/с²</span>
		</div>
		<div>
			xyz: <span id="acceleration-gravity-xyz">0</span><span> м/с²</span>
		</div>

		<h4>Вращение:</h4>
		<div>
			alpha: <span id="rotation-alpha">0</span><span>°/с</span>
		</div>
		<div>
			beta: <span id="rotation-beta">0</span><span>°/с</span>
		</div>
		<div>
			gamma: <span id="rotation-gamma">0</span><span>°/с</span>
		</div>

		<h4>Прочее:</h4>
		<div>
			interval: <span id="interval">0</span><span> мс</span>
		</div>
		<div>
			timeout: <span id="timeout">0</span><span> мс</span>
		</div>

		<h4>Скорость:</h4>
		<div>
			x: <span id="velocity-x">0</span><span> м/с</span>
		</div>
		<div>
			y: <span id="velocity-y">0</span><span> м/с</span>
		</div>
		<div>
			z: <span id="velocity-z">0</span><span> м/с</span>
		</div>
		<div>
			xyz: <span id="velocity-xyz">0</span><span> м/с</span>
		</div>

		<h4>Перемещение:</h4>
		<div>
			x: <span id="offset-x">0</span><span> м</span>
		</div>
		<div>
			y: <span id="offset-y">0</span><span> м</span>
		</div>
		<div>
			z: <span id="offset-z">0</span><span> м</span>
		</div>
		<div>
			xyz: <span id="offset-xyz">0</span><span> м</span>
		</div>
	</div>

	<div>
		<button onclick="reset()">Reset</button>
	</div>
	<script>
		function show(span, value, digits) {
			if (digits !== undefined) {
				value = value.toFixed(3);
			}
			document.getElementById(span).innerHTML = value;
		}

		let start = performance.now();

		let ux, uy, uz, x, y, z, max_a;

		function reset() {
			ux = uy = uz = 0;
			x = y = z = 0;
			max_a = 0;
		}
		
		reset();

		async function getMotion() {
			if (!window.DeviceMotionEvent || !window.DeviceMotionEvent.requestPermission) {
				return alert("Your current device does not have access to the DeviceMotion event");
			}

			let permission = await window.DeviceMotionEvent.requestPermission();
			if (permission !== "granted") {
				return alert("You must grant access to the device's sensor for this demo");
			}
		}

		window.addEventListener("devicemotion", function(e) {
			// Ускорение
			const ax = e.acceleration.x;
			const ay = e.acceleration.y;
			const az = e.acceleration.z;
			const a = Math.hypot(ax, ay, az);
			max_a = Math.max(max_a, a);

			// Ускорение с гравитацией
			const agx = e.accelerationIncludingGravity.x;
			const agy = e.accelerationIncludingGravity.y;
			const agz = e.accelerationIncludingGravity.z;
			const ag = Math.hypot(agx, agy, agz);

			// Прочее
			const end = performance.now();
			const time = end - start;
			start = end;
			const interval = e.interval / 1000;

			// Скорость
			if (Math.abs(a) < 1e-3) {
				ux = 0;
				uy = 0;
				uz = 0;
			} else {
				ux += ax * interval;
				uy += ay * interval;
				uz += az * interval;
			}

			// Перемещение
			x += ux * interval;
			y += uy * interval;
			z += uz * interval;

			show('acceleration-x', ax, 3);
			show('acceleration-y', ay, 3);
			show('acceleration-z', az, 3);
			show('acceleration-xyz', a, 3);
			show('max-acceleration', max_a, 3);

			show('acceleration-gravity-x', agx, 3);
			show('acceleration-gravity-y', agy, 3);
			show('acceleration-gravity-z', agz, 3);
			show('acceleration-gravity-xyz', ag, 3);

			show('rotation-alpha', e.rotationRate.alpha, 3);
			show('rotation-beta', e.rotationRate.beta, 3);
			show('rotation-gamma', e.rotationRate.gamma, 3);

			show('timeout', time, 3);
			show('interval', e.interval);

			show('velocity-x', ux, 3);
			show('velocity-y', uy, 3);
			show('velocity-z', uz, 3);
			show('velocity-xyz', Math.hypot(ux, uy, uz), 3);

			show('offset-x', x, 3);
			show('offset-y', y, 3);
			show('offset-z', z, 3);
			show('offset-xyz', Math.hypot(x, y, z), 3);
		});
	</script>
</body>
</html>
